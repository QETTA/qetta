# KidsMap ì•„í‚¤í…ì²˜ ì„¤ê³„ ë¬¸ì„œ v1.0

## Executive Summary

### í”„ë¡œì íŠ¸ ê°œìš”

**KidsMap**ì€ AI ê¸°ë°˜ ì–´ë¦°ì´ ë†€ì´ ê³µê°„ ê²€ìƒ‰ í”Œë«í¼ì…ë‹ˆë‹¤. ì¹´ì¹´ì˜¤ë§µ ê¸°ë°˜ì˜ MAP-FIRST ì•„í‚¤í…ì²˜ì™€ Claude AI ì¶”ì²œ ì—”ì§„ì„ ê²°í•©í•˜ì—¬, ë¶€ëª¨ë“¤ì´ ì•„ì´ ì—°ë ¹/ë‚ ì”¨/ì‹œê°„ëŒ€ì— ìµœì í™”ëœ ë†€ì´ ì¥ì†Œë¥¼ ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ì§€ì›í•©ë‹ˆë‹¤.

### í•µì‹¬ ì°¨ë³„ì 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  KidsMap vs ì¼ë°˜ ì§€ë„ ì•±                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   ì¼ë°˜ ì§€ë„ ì•±              vs         KidsMap                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
â”‚   í‚¤ì›Œë“œ ê²€ìƒ‰                         AI ë§¥ë½ ì¸ì‹ ì¶”ì²œ            â”‚
â”‚   ì„±ì¸ ì¤‘ì‹¬ ì •ë³´                      Kids ì „ìš© ë©”íƒ€ë°ì´í„°         â”‚
â”‚   ë¦¬ë·°ë§Œ ì˜ì¡´                         ì‹¤ì‹œê°„ í˜¼ì¡ë„ + ì‹ ì„ ë„        â”‚
â”‚   ë†€ì´ë°©/ìˆ˜ìœ ì‹¤ ì •ë³´ ì—†ìŒ              í•µì‹¬ í¸ì˜ì‹œì„¤ ëª…ì‹œ            â”‚
â”‚   ì •ì  ê²€ìƒ‰ ê²°ê³¼                      ë‚ ì”¨/ì‹œê°„ëŒ€ ìµœì í™”            â”‚
â”‚                                                                  â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                  â”‚
â”‚   "í‚¤ì¦ˆì¹´í˜ ì–´ë”” ìˆì§€?"    â†’    "2ì‚´ ì•„ê¸°, ë¹„ì˜¤ëŠ” ë‚ , ì˜¤ì „ 10ì‹œ"   â”‚
â”‚   ìˆ˜ë™ í•„í„°ë§/ê²€ìƒ‰               í•œ ë²ˆì— ìµœì  ì¥ì†Œ ì¶”ì²œ            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### íƒ€ê²Ÿ ì§€ì—­

- **ì„œìš¸**: ê°•ë‚¨êµ¬, ì„œì´ˆêµ¬, ì†¡íŒŒêµ¬
- **ì„±ë‚¨**: ë¶„ë‹¹êµ¬, ìˆ˜ì •êµ¬ (ìœ„ë¡€)

### í•µì‹¬ ê¸°ëŠ¥ íŠ¸ë¦¬

```
KidsMap
â”œâ”€ ğŸ—ºï¸ MAP-FIRST ì¸í„°í˜ì´ìŠ¤
â”‚  â”œâ”€ Kakao Map SDK í†µí•©
â”‚  â”œâ”€ ì‹¤ì‹œê°„ ë§ˆì»¤ ë Œë”ë§
â”‚  â””â”€ ì‚¬ìš©ì ìœ„ì¹˜ ì¶”ì 
â”‚
â”œâ”€ ğŸ¯ Quick Filter (ì•¼ì™¸/ì‹¤ë‚´/ê³µê³µ/ì‹ë‹¹)
â”‚  â”œâ”€ ì›íƒ­ ì¹´í…Œê³ ë¦¬ í•„í„°ë§
â”‚  â”œâ”€ ìƒ‰ìƒ ì½”ë”© (Green/Blue/Purple/Orange)
â”‚  â””â”€ ì¦‰ì‹œ ì§€ë„ ì—…ë°ì´íŠ¸
â”‚
â”œâ”€ ğŸ¤– AI ì¶”ì²œ ì—”ì§„
â”‚  â”œâ”€ Claude API ê¸°ë°˜
â”‚  â”œâ”€ ë§¥ë½ ì¸ì‹ (ë‚ ì”¨, ì‹œê°„, ì—°ë ¹)
â”‚  â””â”€ ê°œì¸í™” (ìµœê·¼ ë°©ë¬¸, ì„ í˜¸ë„)
â”‚
â”œâ”€ ğŸ“± Bottom Sheet
â”‚  â”œâ”€ Google Maps ìŠ¤íƒ€ì¼
â”‚  â”œâ”€ Kids íŠ¹í™” ì •ë³´ (ìˆ˜ìœ ì‹¤, ê¸°ì €ê·€ êµí™˜ëŒ€)
â”‚  â”œâ”€ ì‹ë‹¹ ë©”íƒ€ë°ì´í„° (ë†€ì´ë°© í¬ê¸°, í‚¤ì¦ˆë©”ë‰´)
â”‚  â””â”€ ì•¡ì…˜ (ì €ì¥, ê¸¸ì°¾ê¸°, ê³µìœ )
â”‚
â””â”€ ğŸ’¾ ë°ì´í„° ë¸”ë¡ ì‹œìŠ¤í…œ
   â”œâ”€ PlaceBlock (ì¥ì†Œ ë°ì´í„°)
   â”œâ”€ ContentBlock (ë¦¬ë·°/ì˜ìƒ)
   â”œâ”€ Quality Grading (A-F)
   â””â”€ Freshness (fresh â†’ outdated)
```

---

## 1. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 1.1 ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend (Next.js 15)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚  Map Page    â”‚  â”‚ Zustand      â”‚  â”‚ Components   â”‚        â”‚
â”‚   â”‚  (map-first) â”‚  â”‚ Stores       â”‚  â”‚ (UI Layer)   â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚          â”‚                 â”‚                  â”‚                â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                           â”‚                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚         Kakao Map SDK (Client-side)           â”‚           â”‚
â”‚   â”‚         + useKakaoMap Hook                    â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ HTTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API Routes (Next.js)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   /api/kidsmap/places         â† Place Search                   â”‚
â”‚   /api/kidsmap/recommendations â† AI Recommendations             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL    â”‚ â”‚ Claude API â”‚ â”‚ Kakao Local API â”‚
â”‚   (Supabase)    â”‚ â”‚            â”‚ â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ë°ì´í„° íë¦„

```
ì‚¬ìš©ì ì•¡ì…˜               ì§€ë„ ì´ë™
    â”‚                      â”‚
    â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      filterStore ìƒíƒœ ë³€ê²½      â”‚
â”‚   (category, ageGroups, ...)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Call: /api/kidsmap/places â”‚
â”‚  params: lat, lng, category    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PlaceBlockRepository.search  â”‚
â”‚   + Haversine Distance Calc    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  placeStore.setSearchResult    â”‚
â”‚  + markers ì—…ë°ì´íŠ¸             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Kakao Mapì— ë§ˆì»¤ ë Œë”ë§      â”‚
â”‚    useKakaoMap.addMarker()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ê¸°ìˆ  ìŠ¤íƒ

### 2.1 Core Stack

| Layer | Technology | Version | Purpose |
|-------|-----------|---------|---------|
| Framework | Next.js | 15 (App Router) | SSR, API Routes |
| UI Library | React | 19 | Component System |
| Language | TypeScript | 5 | Type Safety |
| Styling | Tailwind CSS | 4 | Utility-first CSS |
| State | Zustand | 5 | Client State Management |
| Database | PostgreSQL | 16 | Relational DB |
| ORM | Prisma | 7 | Type-safe DB Access |
| Map SDK | Kakao Maps | JavaScript SDK | Map Rendering |
| AI | Claude API | Sonnet 4 | Recommendations |
| UI Components | HeadlessUI | 2 | Accessible Components |

### 2.2 Environment Variables

```bash
# Kakao Map
NEXT_PUBLIC_KAKAO_MAP_KEY=         # JavaScript SDK Key (Public)
KAKAO_REST_API_KEY=                # REST API Key (Server)

# Claude AI
ANTHROPIC_API_KEY=                 # AI Recommendations

# Database
DATABASE_URL=                      # PostgreSQL Connection

# Data Sources (í¬ë¡¤ë§ìš©)
TOUR_API_KEY=                      # í•œêµ­ê´€ê´‘ê³µì‚¬
PLAYGROUND_API_KEY=                # ì–´ë¦°ì´ë†€ì´í„°
YOUTUBE_API_KEY=                   # YouTube ë¦¬ë·°
NAVER_CLIENT_ID=                   # Naver Blog/Clip
NAVER_CLIENT_SECRET=
REDIS_URL=                         # BullMQ Crawling Queue
```

---

## 3. ë°ì´í„° ëª¨ë¸

### 3.1 Database Schema

#### kidsmap_place_blocks

```sql
CREATE TABLE kidsmap_place_blocks (
    id UUID PRIMARY KEY,

    -- ì •ê·œí™”ëœ ë°ì´í„° (NormalizedPlace)
    data JSONB NOT NULL,

    -- ë¸”ë¡ ë©”íƒ€
    status block_status NOT NULL DEFAULT 'active',
    quality_grade quality_grade NOT NULL DEFAULT 'C',
    freshness freshness_level NOT NULL DEFAULT 'fresh',
    completeness INT NOT NULL DEFAULT 0,  -- 0-100

    -- ê²€ìƒ‰ ìµœì í™” (JSONBì—ì„œ ì¶”ì¶œ)
    name VARCHAR(255) NOT NULL,
    category place_category NOT NULL,
    source place_source NOT NULL,
    source_id VARCHAR(100) NOT NULL,
    latitude DECIMAL(10,8),
    longitude DECIMAL(11,8),
    address TEXT,
    region_code VARCHAR(10),

    -- ì¤‘ë³µ ì²´í¬
    dedupe_hash VARCHAR(64) UNIQUE NOT NULL,

    -- ê´€ê³„
    related_content_ids UUID[],
    search_keywords TEXT[],

    -- íƒ€ì„ìŠ¤íƒ¬í”„
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    last_crawled_at TIMESTAMPTZ DEFAULT NOW(),
    crawl_count INT DEFAULT 1,

    -- ì¸ë±ìŠ¤
    INDEX idx_status (status),
    INDEX idx_category (category),
    INDEX idx_location (latitude, longitude),
    INDEX idx_region (region_code),
    INDEX idx_quality (quality_grade),
    GIN INDEX idx_data (data),
    GIN INDEX idx_keywords (search_keywords)
);
```

### 3.2 TypeScript Types

#### NormalizedPlace (Core Type)

```typescript
interface NormalizedPlace {
  // ê¸°ë³¸ ì •ë³´
  id: string
  source: PlaceSource
  sourceUrl: string
  fetchedAt: string

  // ì¥ì†Œ ì •ë³´
  name: string
  category: PlaceCategory
  address?: string
  latitude?: number
  longitude?: number
  tel?: string
  description?: string

  // Kids ë©”íƒ€ë°ì´í„°
  recommendedAges?: AgeGroup[]
  amenities?: Amenities
  operatingHours?: OperatingHours
  crowdLevel?: CrowdLevel

  // ì‹ë‹¹ ì „ìš©
  restaurantMetadata?: RestaurantMetadata

  // Raw Data
  rawData?: unknown
}
```

#### RestaurantMetadata

```typescript
interface RestaurantMetadata {
  hasPlayroom: boolean
  playroomSize?: number             // í‰ìˆ˜
  playroomAges?: AgeGroup[]
  guardianRequired?: boolean        // ë³´í˜¸ì ë™ë°˜ í•„ìˆ˜
  attendantAvailable?: boolean      // ë†€ì´ë°© ì„ ìƒë‹˜
  kidsMenuAvailable?: boolean
  kidsMenuPriceRange?: { min: number; max: number }
  babyChairCount?: number
  nursingRoomAvailable?: boolean
  changingStationAvailable?: boolean
  parkingInfo?: {
    available: boolean
    free?: boolean
    capacity?: number
  }
  reservation?: ReservationInfo
  waitingTime?: number              // ëŒ€ê¸°ì‹œê°„ (ë¶„)
  cuisineType?: string[]
  priceLevel?: number               // 1-5
}
```

#### Amenities

```typescript
interface Amenities {
  parking?: boolean
  nursingRoom?: boolean
  diaperChangingStation?: boolean   // ê¸°ì €ê·€ êµí™˜ëŒ€
  strollerAccess?: boolean
  indoor?: boolean
  outdoor?: boolean
  freeEntry?: boolean
  restaurant?: boolean
}
```

#### CrowdLevel (í˜¼ì¡ë„)

```typescript
interface CrowdLevel {
  current?: number                  // í˜„ì¬ í˜¼ì¡ë„ (1-5)
  hourly?: Array<{                  // ì‹œê°„ëŒ€ë³„ ì˜ˆì¸¡
    hour: number                    // 0-23
    level: number                   // 1-5
  }>
  weekend?: number                  // ì£¼ë§ í‰ê· 
  holiday?: number                  // ê³µíœ´ì¼ í‰ê· 
  lastUpdated?: string
}
```

---

## 4. ìƒíƒœ ê´€ë¦¬ (Zustand Stores)

### 4.1 mapStore

```typescript
interface MapState {
  // ì§€ë„ ìƒíƒœ
  center: MapCenter                 // { lat, lng }
  zoom: number                      // 1-14
  bounds: MapBounds | null

  // ë§ˆì»¤
  markers: PlaceMarker[]
  selectedMarkerId: string | null

  // ì‚¬ìš©ì ìœ„ì¹˜
  userLocation: MapCenter | null
  isLocating: boolean

  // Actions
  setCenter: (center: MapCenter) => void
  setMarkers: (markers: PlaceMarker[]) => void
  selectMarker: (markerId: string | null) => void
  requestUserLocation: () => Promise<void>
  panTo: (center: MapCenter, zoom?: number) => void
}
```

**Persistence**: ì—†ìŒ (ì„¸ì…˜ ìƒíƒœë§Œ)

### 4.2 filterStore

```typescript
interface FilterState {
  // Quick Filter
  filterCategory: FilterCategory | null  // 'outdoor' | 'indoor' | 'public' | 'restaurant'

  // ìƒì„¸ í•„í„°
  placeCategories: PlaceCategory[]
  ageGroups: AgeGroup[]
  maxDistance: number | null
  priceRange: { min: number | null; max: number | null }

  // Amenities
  amenities: {
    parking?: boolean
    nursingRoom?: boolean
    diaperChangingStation?: boolean
    strollerAccess?: boolean
  }

  // Restaurant
  restaurant: {
    hasPlayroom?: boolean
    kidsMenuAvailable?: boolean
    reservationAvailable?: boolean
  }

  // Sorting
  sortBy: 'distance' | 'rating' | 'recent' | 'popular'
  openNow: boolean

  // Actions
  setFilterCategory: (category: FilterCategory | null) => void
  setAgeGroups: (ages: AgeGroup[]) => void
  clearFilters: () => void
}
```

**Persistence**: localStorage (kidsmap-filter-storage)

### 4.3 placeStore

```typescript
interface PlaceState {
  // ê²€ìƒ‰ ê²°ê³¼
  searchResult: SearchResult | null
  isSearching: boolean
  searchError: string | null

  // ì„ íƒëœ ì¥ì†Œ (Bottom Sheet)
  selectedPlace: PlaceWithDistance | null

  // ì¦ê²¨ì°¾ê¸°
  favorites: string[]               // Place IDs
  favoritePlaces: PlaceWithDistance[]

  // ìµœê·¼ ë°©ë¬¸
  recentVisits: Array<{
    placeId: string
    placeName: string
    visitedAt: string
  }>  // ìµœëŒ€ 20ê°œ

  // AI ì¶”ì²œ
  recommendations: PlaceWithDistance[]
  isLoadingRecommendations: boolean

  // Actions
  setSearchResult: (result: SearchResult) => void
  selectPlace: (place: PlaceWithDistance | null) => void
  toggleFavorite: (placeId: string, place?: PlaceWithDistance) => void
  addRecentVisit: (placeId: string, placeName: string) => void
}
```

**Persistence**: localStorage (kidsmap-place-storage)
- favorites, favoritePlaces, recentVisitsë§Œ persist

---

## 5. API Routes ì„¤ê³„

### 5.1 GET /api/kidsmap/places

**ëª©ì **: ì¥ì†Œ ê²€ìƒ‰ ë° í•„í„°ë§

#### Request

```typescript
GET /api/kidsmap/places?lat=37.497&lng=127.027&radius=5000&category=outdoor&ageGroups=toddler,child&page=1&pageSize=20&openNow=true
```

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| lat | number | âœ“ | ì¤‘ì‹¬ ìœ„ë„ |
| lng | number | âœ“ | ì¤‘ì‹¬ ê²½ë„ |
| radius | number | | ë°˜ê²½ (m, default: 5000) |
| q | string | | ê²€ìƒ‰ í‚¤ì›Œë“œ |
| category | FilterCategory | | 'outdoor', 'indoor', 'public', 'restaurant' |
| placeCategories | string | | 'kids_cafe,museum' (comma-separated) |
| ageGroups | string | | 'infant,toddler' (comma-separated) |
| page | number | | í˜ì´ì§€ ë²ˆí˜¸ (default: 1) |
| pageSize | number | | í˜ì´ì§€ í¬ê¸° (default: 20) |
| openNow | boolean | | ì˜ì—… ì¤‘ì¸ ê³³ë§Œ |

#### Response

```json
{
  "success": true,
  "data": {
    "places": [
      {
        "id": "uuid-...",
        "name": "ê°•ë‚¨ í‚¤ì¦ˆì¹´í˜",
        "category": "kids_cafe",
        "address": "ì„œìš¸ ê°•ë‚¨êµ¬...",
        "latitude": 37.497,
        "longitude": 127.027,
        "distance": 1234,
        "recommendedAges": ["toddler", "child"],
        "amenities": {
          "parking": true,
          "nursingRoom": true,
          "diaperChangingStation": true
        },
        "qualityGrade": "A",
        "completeness": 95,
        "blockId": "uuid-..."
      }
    ],
    "total": 42,
    "page": 1,
    "pageSize": 20,
    "hasMore": true
  }
}
```

#### Implementation

```typescript
export async function GET(request: NextRequest) {
  const { searchParams } = request.nextUrl

  // 1. Parse parameters
  const lat = parseFloat(searchParams.get('lat')!)
  const lng = parseFloat(searchParams.get('lng')!)
  const radius = parseInt(searchParams.get('radius') || '5000')

  // 2. Build filter
  const filter = {
    status: 'active',
    categories: placeCategories.length > 0 ? placeCategories : undefined,
    searchKeyword: query || undefined,
  }

  // 3. Search from repository
  const repo = getPlaceBlockRepository()
  const result = await repo.search(filter, { page, pageSize, sortBy })

  // 4. Calculate distance (Haversine formula)
  result.data = result.data.map(place => ({
    ...place,
    distance: calculateDistance(lat, lng, place.latitude, place.longitude)
  }))

  // 5. Filter by radius
  result.data = result.data.filter(place => place.distance <= radius)

  // 6. Filter by age groups (client-side)
  if (ageGroups.length > 0) {
    result.data = result.data.filter(place =>
      ageGroups.some(age => place.recommendedAges?.includes(age))
    )
  }

  return NextResponse.json({ success: true, data: result })
}
```

### 5.2 POST /api/kidsmap/recommendations

**ëª©ì **: AI ê¸°ë°˜ ë§¥ë½ ì¸ì‹ ì¶”ì²œ

#### Request

```json
{
  "userLocation": { "lat": 37.497, "lng": 127.027 },
  "childAge": "toddler",
  "weather": "ë¹„",
  "time": "2026-02-01T10:00:00Z",
  "recentVisits": ["place-id-1", "place-id-2"],
  "preferences": {
    "categories": ["kids_cafe", "indoor_playground"],
    "maxDistance": 5000,
    "priceRange": { "min": null, "max": 50000 }
  }
}
```

#### Response

```json
{
  "success": true,
  "data": {
    "recommendations": [
      {
        "id": "place-id",
        "name": "ê°•ë‚¨ í‚¤ì¦ˆì¹´í˜",
        "category": "kids_cafe",
        "distance": 1234,
        "...": "..."
      }
    ],
    "reasoning": "ë¹„ ì˜¤ëŠ” ë‚  ì˜¤ì „ 10ì‹œì—ëŠ” ì‹¤ë‚´ í‚¤ì¦ˆì¹´í˜ê°€ ì í•©í•©ë‹ˆë‹¤. 2-3ì„¸ ìœ ì•„ ì „ìš© ê³µê°„ì´ ìˆëŠ” ê³³ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. ì£¼ë§ í˜¼ì¡ë„ë¥¼ ê³ ë ¤í•˜ì—¬ í•œì‚°í•œ ì‹œê°„ëŒ€ì…ë‹ˆë‹¤."
  }
}
```

#### Claude Prompt êµ¬ì¡°

```typescript
function buildRecommendationPrompt(request, places) {
  const ageDescription = {
    infant: 'ì˜ì•„ (0-2ì„¸)',
    toddler: 'ìœ ì•„ (3-5ì„¸)',
    child: 'ì•„ë™ (6-9ì„¸)',
    elementary: 'ì´ˆë“±í•™ìƒ (10-12ì„¸)',
  }[request.childAge]

  const hour = new Date(request.time).getHours()
  const isWeekend = new Date(request.time).getDay() === 0 || === 6

  return `ë‹¹ì‹ ì€ KidsMap AI ì¶”ì²œ ì—”ì§„ì…ë‹ˆë‹¤. ë¶€ëª¨ë¥¼ ìœ„í•´ ìµœì ì˜ ë†€ì´ ì¥ì†Œë¥¼ ì¶”ì²œí•˜ì„¸ìš”.

## ì‚¬ìš©ì ì •ë³´
- ìë…€ ì—°ë ¹: ${ageDescription}
- í˜„ì¬ ìœ„ì¹˜: (${request.userLocation.lat}, ${request.userLocation.lng})
- ë‚ ì”¨: ${request.weather || 'ì •ë³´ ì—†ìŒ'}
- ì‹œê°„: ${hour}ì‹œ (${isWeekend ? 'ì£¼ë§' : 'í‰ì¼'})

## ì¶”ì²œ ê¸°ì¤€
1. **ì—°ë ¹ ì í•©ì„±**: ${ageDescription}ì— ì í•©í•œ ì¥ì†Œ
2. **ì‹œê°„ëŒ€**: ${hour}ì‹œ ê¸°ì¤€ ì˜ì—… ì¤‘ì´ê±°ë‚˜ ë°©ë¬¸í•˜ê¸° ì¢‹ì€ ì‹œê°„
3. **ë‚ ì”¨**: ${request.weather === 'ë¹„' ? 'ì‹¤ë‚´ ì¥ì†Œ ìš°ì„ ' : 'ì•¼ì™¸ ì¥ì†Œ í¬í•¨'}
4. **í˜¼ì¡ë„**: ${isWeekend ? 'ì£¼ë§ í˜¼ì¡ë„ ê³ ë ¤' : 'í‰ì¼ í•œì‚°í•œ ì‹œê°„ëŒ€'}
5. **í’ˆì§ˆ**: ë†’ì€ í’ˆì§ˆ ë“±ê¸‰ ìš°ì„ 

## ê°€ëŠ¥í•œ ì¥ì†Œ (${places.length}ê°œ)
${places.slice(0, 20).map((place, idx) => `
${idx + 1}. ID: ${place.id}
   ì´ë¦„: ${place.name}
   ì¹´í…Œê³ ë¦¬: ${place.category}
   í’ˆì§ˆ: ${place.qualityGrade}
   í¸ì˜ì‹œì„¤: ${JSON.stringify(place.amenities)}
   ì¶”ì²œ ì—°ë ¹: ${place.recommendedAges?.join(', ')}
`).join('\n')}

## ì‘ë‹µ í˜•ì‹ (JSON)
{
  "recommendations": ["place_id_1", "place_id_2", "place_id_3"],
  "reasoning": "ì¶”ì²œ ì´ìœ ë¥¼ ê°„ë‹¨íˆ ì„¤ëª…"
}

**ì¤‘ìš”**: ìœ„ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”.`
}
```

---

## 6. ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

### 6.1 Directory Structure

```
app/
â”œâ”€ (kidsmap)/
â”‚  â”œâ”€ layout.tsx              â† KakaoMapProvider
â”‚  â””â”€ map/
â”‚     â””â”€ page.tsx             â† Main MAP-FIRST Page

components/
â””â”€ kidsmap/
   â”œâ”€ place-detail-sheet.tsx  â† Bottom Sheet
   â”œâ”€ quick-filter.tsx        â† Filter Chips
   â””â”€ index.ts

contexts/
â””â”€ kakao-map-context.tsx      â† SDK Loader

hooks/
â””â”€ use-kakao-map.ts           â† Map Hook

stores/
â””â”€ kidsmap/
   â”œâ”€ map-store.ts
   â”œâ”€ filter-store.ts
   â”œâ”€ place-store.ts
   â””â”€ index.ts
```

### 6.2 Component: KidsMapPage

**Path**: `app/(kidsmap)/map/page.tsx`

**Features**:
- Full-screen Kakao Map
- Quick Filter overlay (top-left)
- Results count (top-right)
- User location button (bottom-right)
- Bottom Sheet (bottom)

**Key Hooks**:
- `useKakaoMapContext()`: SDK ë¡œë”© ìƒíƒœ
- `useKakaoMap()`: ì§€ë„ ì¸ìŠ¤í„´ìŠ¤
- `useMapStore()`: ì§€ë„ ìƒíƒœ
- `useFilterStore()`: í•„í„° ìƒíƒœ
- `usePlaceStore()`: ì¥ì†Œ ë°ì´í„°

**Effects**:

```typescript
// 1. ì‚¬ìš©ì ìœ„ì¹˜ ìš”ì²­
useEffect(() => {
  if (!userLocation) {
    requestUserLocation()
  }
}, [])

// 2. ê²€ìƒ‰ (ì§€ë„/í•„í„° ë³€ê²½ ì‹œ)
useEffect(() => {
  if (isReady && center) {
    searchPlaces()
  }
}, [isReady, center, filterCategory, ageGroups])

// 3. ë§ˆì»¤ ë Œë”ë§
useEffect(() => {
  if (!isReady || !searchResult) return
  clearMarkers()
  searchResult.places.forEach(place => {
    addMarker({ ...place, onClick: (id) => selectPlace(id) })
  })
}, [isReady, searchResult])

// 4. ì„ íƒëœ ì¥ì†Œë¡œ ì´ë™
useEffect(() => {
  if (selectedPlace) {
    panTo({ lat: selectedPlace.latitude, lng: selectedPlace.longitude }, 3)
  }
}, [selectedPlace])
```

### 6.3 Component: PlaceDetailSheet

**Path**: `components/kidsmap/place-detail-sheet.tsx`

**Features**:
- HeadlessUI Dialog
- Drag-to-close gesture
- Kids metadata display
- Restaurant section (conditional)
- Action buttons (favorite, directions, share)

**Sections**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œ (drag handle)         â”‚ â† Drag gesture area
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ê°•ë‚¨ í‚¤ì¦ˆì¹´í˜           âœ•       â”‚ â† Header
â”‚ Kids Cafe                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ 1.2 km away                  â”‚
â”‚ ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123        â”‚ â† Location
â”‚                                 â”‚
â”‚ Recommended Ages                â”‚ â† Ages
â”‚ [Toddler 3-5] [Child 6-9]       â”‚
â”‚                                 â”‚
â”‚ Amenities                       â”‚ â† Amenities
â”‚ ğŸ…¿ï¸ Parking  ğŸ¼ Nursing Room    â”‚
â”‚ ğŸ‘¶ Diaper Station  ğŸš¼ Stroller  â”‚
â”‚                                 â”‚
â”‚ ğŸ® Restaurant with Playroom     â”‚ â† Restaurant (if applicable)
â”‚ â€¢ Playroom: 30í‰                â”‚
â”‚ â€¢ Kids menu available           â”‚
â”‚ â€¢ Baby chairs: 10               â”‚
â”‚                                 â”‚
â”‚ â˜ 02-1234-5678                  â”‚ â† Contact
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [â™¥ Save] [â†’ Directions] [â‹¯ Share] â”‚ â† Actions
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Gestures**:

```typescript
const handleTouchMove = (e: React.TouchEvent) => {
  const deltaY = e.touches[0].clientY - dragStartY.current
  if (deltaY > 0) {
    setDragY(deltaY)
  }
}

const handleTouchEnd = () => {
  if (dragY > 100) {
    selectPlace(null)  // Close
  }
  setDragY(0)
}
```

### 6.4 Component: QuickFilter

**Path**: `components/kidsmap/quick-filter.tsx`

**Variants**:
1. **QuickFilter**: Full version with labels
2. **QuickFilterCompact**: Icon-only version
3. **QuickFilterBadge**: Active filter badge

**Filters**:

| Value | Icon | Label (EN) | Label (KR) | Color |
|-------|------|------------|------------|-------|
| outdoor | ğŸŒ³ | Outdoor | ì•¼ì™¸ | Green |
| indoor | ğŸ  | Indoor | ì‹¤ë‚´ | Blue |
| public | ğŸ›ï¸ | Public | ê³µê³µ | Purple |
| restaurant | ğŸ½ï¸ | Restaurant | ì‹ë‹¹ | Orange |

**State**:

```typescript
const handleFilterClick = (category: FilterCategory) => {
  if (filterCategory === category) {
    setFilterCategory(null)  // Deselect
  } else {
    setFilterCategory(category)  // Select
  }
}
```

---

## 7. Kakao Map í†µí•©

### 7.1 SDK Loading (Context)

**Path**: `contexts/kakao-map-context.tsx`

```typescript
export function KakaoMapProvider({ children }: { children: ReactNode }) {
  const [isLoaded, setIsLoaded] = useState(false)
  const [error, setError] = useState<Error | null>(null)

  useEffect(() => {
    const key = process.env.NEXT_PUBLIC_KAKAO_MAP_KEY
    if (!key) {
      setError(new Error('Kakao Map API key is required'))
      return
    }

    if (window.kakao?.maps) {
      window.kakao.maps.load(() => setIsLoaded(true))
      return
    }

    const script = document.createElement('script')
    script.src = `https://dapi.kakao.com/v2/maps/sdk.js?appkey=${key}&autoload=false&libraries=services,clusterer`
    script.onload = () => {
      window.kakao.maps.load(() => setIsLoaded(true))
    }
    script.onerror = () => {
      setError(new Error('Failed to load Kakao Maps SDK'))
    }
    document.head.appendChild(script)
  }, [])

  return (
    <KakaoMapContext.Provider value={{ isLoaded, error, kakao: window.kakao }}>
      {children}
    </KakaoMapContext.Provider>
  )
}
```

### 7.2 Map Hook

**Path**: `hooks/use-kakao-map.ts`

```typescript
export function useKakaoMap(options?: UseKakaoMapOptions) {
  const { isLoaded, kakao } = useKakaoMapContext()
  const mapRef = useRef<HTMLDivElement>(null)
  const [map, setMap] = useState<any>(null)
  const markersRef = useRef<Map<string, any>>(new Map())

  // Initialize map
  const initMap = useCallback((container: HTMLElement) => {
    if (!isLoaded || !kakao) return

    const mapCenter = new kakao.maps.LatLng(center.lat, center.lng)
    const mapInstance = new kakao.maps.Map(container, {
      center: mapCenter,
      level: zoom,
    })

    // Sync events with Zustand
    kakao.maps.event.addListener(mapInstance, 'center_changed', () => {
      setCenter({ lat: mapInstance.getCenter().getLat(), ... })
    })

    setMap(mapInstance)
  }, [isLoaded, kakao])

  // Marker management
  const addMarker = useCallback((markerData: PlaceMarker) => {
    const marker = new kakao.maps.Marker({
      position: new kakao.maps.LatLng(markerData.lat, markerData.lng),
      map,
      title: markerData.title,
    })

    kakao.maps.event.addListener(marker, 'click', () => {
      markerData.onClick?.(markerData.id)
    })

    markersRef.current.set(markerData.id, marker)
    return marker
  }, [map, kakao])

  const clearMarkers = useCallback(() => {
    markersRef.current.forEach(marker => marker.setMap(null))
    markersRef.current.clear()
  }, [])

  return {
    mapRef,
    map,
    isReady: !!map,
    initMap,
    addMarker,
    clearMarkers,
    panTo: (center, level) => {
      map.panTo(new kakao.maps.LatLng(center.lat, center.lng))
      if (level) map.setLevel(level)
    },
  }
}
```

---

## 8. ë°ì´í„° ë¸”ë¡ ì‹œìŠ¤í…œ

### 8.1 Quality Grading

**ì™„ì „ì„± ì ìˆ˜ (0-100)**:

```typescript
function calculateCompleteness(place: NormalizedPlace): number {
  let score = 0
  let totalWeight = 0

  const weights = {
    name: 15,
    address: 10,
    location: 20,
    tel: 5,
    description: 10,
    amenities: 15,
    operatingHours: 10,
    recommendedAges: 10,
    crowdLevel: 5,
  }

  if (place.name) score += weights.name
  if (place.address) score += weights.address
  if (place.latitude && place.longitude) score += weights.location
  if (place.tel) score += weights.tel
  if (place.description) score += weights.description
  if (place.amenities && Object.keys(place.amenities).length > 0) score += weights.amenities
  if (place.operatingHours) score += weights.operatingHours
  if (place.recommendedAges && place.recommendedAges.length > 0) score += weights.recommendedAges
  if (place.crowdLevel) score += weights.crowdLevel

  totalWeight = Object.values(weights).reduce((a, b) => a + b, 0)

  return Math.round((score / totalWeight) * 100)
}
```

**í’ˆì§ˆ ë“±ê¸‰ (A-F)**:

| Grade | Completeness | ì„¤ëª… |
|-------|--------------|-----|
| A | 90-100 | ë§¤ìš° ì™„ì „í•œ ë°ì´í„° |
| B | 75-89 | ì–‘í˜¸í•œ ë°ì´í„° |
| C | 60-74 | ë³´í†µ ë°ì´í„° |
| D | 40-59 | ë¶€ì¡±í•œ ë°ì´í„° |
| F | 0-39 | ë§¤ìš° ë¶€ì¡±í•œ ë°ì´í„° |

### 8.2 Freshness Levels

**ì‹ ì„ ë„ ê³„ì‚°** (ìë™ íŠ¸ë¦¬ê±°):

```sql
CREATE OR REPLACE FUNCTION update_kidsmap_freshness()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.last_crawled_at > NOW() - INTERVAL '7 days' THEN
        NEW.freshness = 'fresh';
    ELSIF NEW.last_crawled_at > NOW() - INTERVAL '30 days' THEN
        NEW.freshness = 'recent';
    ELSIF NEW.last_crawled_at > NOW() - INTERVAL '90 days' THEN
        NEW.freshness = 'stale';
    ELSE
        NEW.freshness = 'outdated';
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

| Level | Days Since Crawl | Action Required |
|-------|-----------------|----------------|
| fresh | < 7 days | None |
| recent | 7-30 days | Monitor |
| stale | 30-90 days | Re-crawl soon |
| outdated | > 90 days | Re-crawl urgently |

### 8.3 Deduplication

**í•´ì‹œ ìƒì„±**:

```typescript
function generatePlaceDedupeHash(place: NormalizedPlace): string {
  const normalizedName = place.name.toLowerCase().replace(/\s+/g, '')
  const normalizedAddress = (place.address || '').toLowerCase().replace(/\s+/g, '')
  const latRounded = place.latitude?.toFixed(6) || ''
  const lngRounded = place.longitude?.toFixed(6) || ''

  const composite = `${normalizedName}|${normalizedAddress}|${latRounded}|${lngRounded}`

  return createHash('sha256').update(composite, 'utf8').digest('hex')
}
```

**ì¤‘ë³µ ì²˜ë¦¬**:

```sql
INSERT INTO kidsmap_place_blocks (...)
VALUES (...)
ON CONFLICT (dedupe_hash)
DO UPDATE SET
    data = EXCLUDED.data,
    updated_at = NOW(),
    last_crawled_at = NOW(),
    crawl_count = kidsmap_place_blocks.crawl_count + 1;
```

---

## 9. í¬ë¡¤ë§ ì•„í‚¤í…ì²˜

### 9.1 Data Sources

| Source | Type | Coverage | Update Frequency |
|--------|------|----------|-----------------|
| í•œêµ­ê´€ê´‘ê³µì‚¬ API | Official | Nationwide | Daily |
| ì–´ë¦°ì´ë†€ì´í„° API | Official | Public playgrounds | Weekly |
| Kakao Local API | Commercial | POI search | Real-time |
| YouTube API | UGC | Reviews/Videos | Daily |
| Naver Blog | UGC | Reviews | Daily |
| Naver Clip | UGC | Short videos | Daily |

### 9.2 Crawl Jobs (BullMQ)

```typescript
interface CrawlJob {
  id: string
  type: CrawlJobType
  status: CrawlJobStatus
  priority: number  // 1-10
  config: {
    source: DataSource
    region?: string
    category?: PlaceCategory
    batchSize?: number
    retryCount?: number
  }
  progress: {
    totalEstimated: number
    processed: number
    succeeded: number
    failed: number
    skipped: number
    percentage: number
  }
  result?: {
    newBlocks: number
    updatedBlocks: number
    skippedBlocks: number
    errors: number
  }
}
```

**Job Types**:

| Type | Description | Frequency |
|------|-------------|-----------|
| FULL_CRAWL | ì „ì²´ ë°ì´í„° ìˆ˜ì§‘ | Monthly |
| INCREMENTAL | ì¦ë¶„ ì—…ë°ì´íŠ¸ | Daily |
| REGION_CRAWL | íŠ¹ì • ì§€ì—­ | On-demand |
| CATEGORY_CRAWL | íŠ¹ì • ì¹´í…Œê³ ë¦¬ | On-demand |
| CONTENT_REFRESH | ì½˜í…ì¸  ì—…ë°ì´íŠ¸ | Weekly |
| QUALITY_CHECK | í’ˆì§ˆ ê²€ì¦ | Weekly |
| DEDUP_SCAN | ì¤‘ë³µ ì œê±° | Monthly |

### 9.3 ETL Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Data Source â”‚
â”‚ (API/Scrape) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Extract    â”‚ â† Raw data fetch
â”‚ (API Client) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Transform   â”‚ â† Normalize to NormalizedPlace
â”‚ (Normalizer) â”‚    + Quality check
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    + Dedupe hash
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Quality    â”‚ â† Calculate completeness
â”‚   Grading    â”‚    + Assign grade
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    + Extract keywords
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Load     â”‚ â† Upsert to DB
â”‚ (Repository) â”‚    + Update stats
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. ì„±ëŠ¥ ìµœì í™”

### 10.1 Database Indexes

```sql
-- 1. ìœ„ì¹˜ ê²€ìƒ‰ ìµœì í™”
CREATE INDEX idx_place_blocks_location ON kidsmap_place_blocks(latitude, longitude);

-- 2. ì¹´í…Œê³ ë¦¬ í•„í„°ë§
CREATE INDEX idx_place_blocks_category ON kidsmap_place_blocks(category)
WHERE status = 'active';

-- 3. í’ˆì§ˆ ì •ë ¬
CREATE INDEX idx_place_blocks_quality ON kidsmap_place_blocks(quality_grade, completeness DESC);

-- 4. Full-text search (Korean)
CREATE INDEX idx_place_blocks_name ON kidsmap_place_blocks
USING gin(to_tsvector('korean', name));

-- 5. JSONB ê²€ìƒ‰
CREATE INDEX idx_place_blocks_data ON kidsmap_place_blocks USING gin(data);

-- 6. Keywords ê²€ìƒ‰
CREATE INDEX idx_place_blocks_keywords ON kidsmap_place_blocks USING gin(search_keywords);
```

### 10.2 Caching Strategy

| Layer | Strategy | TTL | Tool |
|-------|----------|-----|------|
| API Response | Server-side cache | 5 min | Redis |
| Place Search | In-memory cache | 1 min | Map<string, SearchResult> |
| Kakao API | Client cache | 30 min | KakaoLocalClient |
| Static Assets | CDN | 1 year | Vercel Edge |
| Map Tiles | Browser cache | 7 days | Kakao SDK |

### 10.3 Query Optimization

**Bad**:
```typescript
// âŒ N+1 query problem
for (const placeId of placeIds) {
  const place = await prisma.kidsmapPlaceBlock.findUnique({ where: { id: placeId } })
}
```

**Good**:
```typescript
// âœ… Batch query
const places = await prisma.kidsmapPlaceBlock.findMany({
  where: { id: { in: placeIds } }
})
```

### 10.4 Frontend Performance

| Technique | Implementation | Impact |
|-----------|----------------|--------|
| Code Splitting | Next.js dynamic imports | -40% initial bundle |
| Image Optimization | next/image | -60% image size |
| Virtualization | react-window (future) | Infinite scroll |
| Debouncing | Search input (300ms) | -90% API calls |
| Lazy Loading | Bottom sheet content | -20% initial render |
| Service Worker | Offline map tiles (future) | Offline support |

---

## 11. ë³´ì•ˆ ë° ê¶Œí•œ

### 11.1 Row Level Security (RLS)

```sql
-- Place Blocks: ì½ê¸°ëŠ” ëª¨ë‘ í—ˆìš©, ì“°ê¸°ëŠ” service_roleë§Œ
CREATE POLICY "place_blocks_read_policy" ON kidsmap_place_blocks
    FOR SELECT
    USING (status IN ('active', 'archived'));

CREATE POLICY "place_blocks_write_policy" ON kidsmap_place_blocks
    FOR ALL
    USING (auth.role() = 'service_role');
```

### 11.2 API Keys

| Key | Type | Exposure | Usage |
|-----|------|----------|-------|
| NEXT_PUBLIC_KAKAO_MAP_KEY | Public | Client-side | Map rendering |
| KAKAO_REST_API_KEY | Private | Server-side | Kakao API calls |
| ANTHROPIC_API_KEY | Private | Server-side | AI recommendations |
| DATABASE_URL | Private | Server-side | Prisma connection |

**Environment Validation**:

```typescript
const requiredEnvVars = [
  'NEXT_PUBLIC_KAKAO_MAP_KEY',
  'KAKAO_REST_API_KEY',
  'ANTHROPIC_API_KEY',
  'DATABASE_URL',
]

for (const varName of requiredEnvVars) {
  if (!process.env[varName]) {
    throw new Error(`Missing required environment variable: ${varName}`)
  }
}
```

### 11.3 Rate Limiting

| Endpoint | Limit | Window | Strategy |
|----------|-------|--------|----------|
| /api/kidsmap/places | 100 req | 1 min | IP-based |
| /api/kidsmap/recommendations | 10 req | 1 min | IP-based |
| Claude API | 5000 req | 1 day | Account-based |
| Kakao API | 300,000 req | 1 day | Account-based |

---

## 12. ë°°í¬ ë° ëª¨ë‹ˆí„°ë§

### 12.1 Deployment Stack

| Component | Platform | Configuration |
|-----------|----------|---------------|
| Frontend | Vercel | Edge Functions, ISR |
| Database | Supabase | PostgreSQL 16 |
| Redis | Upstash | Serverless Redis |
| CDN | Vercel Edge | Global |
| Analytics | Vercel Analytics | Web Vitals |

### 12.2 Environment Setup

```bash
# Production
vercel env add NEXT_PUBLIC_KAKAO_MAP_KEY
vercel env add KAKAO_REST_API_KEY
vercel env add ANTHROPIC_API_KEY
vercel env add DATABASE_URL
vercel env add REDIS_URL

# Preview
vercel env add NEXT_PUBLIC_KAKAO_MAP_KEY preview
...

# Development
cp .env.example .env.local
# Fill in values
```

### 12.3 Health Checks

```typescript
// /api/health
export async function GET() {
  const checks = {
    database: await checkDatabase(),
    redis: await checkRedis(),
    kakaoApi: await checkKakaoApi(),
    claudeApi: await checkClaudeApi(),
  }

  const isHealthy = Object.values(checks).every(check => check.status === 'ok')

  return NextResponse.json({
    status: isHealthy ? 'healthy' : 'degraded',
    checks,
    timestamp: new Date().toISOString(),
  }, {
    status: isHealthy ? 200 : 503
  })
}
```

### 12.4 Monitoring Metrics

| Metric | Tool | Alert Threshold |
|--------|------|----------------|
| Response Time | Vercel Analytics | > 2s |
| Error Rate | Sentry | > 1% |
| API Quota | Custom | > 80% |
| Database Connections | Supabase | > 80 |
| Cache Hit Rate | Redis | < 70% |
| Map Load Time | Real User Monitoring | > 3s |

---

## 13. í–¥í›„ ê°œì„  ì‚¬í•­

### 13.1 Phase 2 Features

| Feature | Priority | Effort | Impact |
|---------|----------|--------|--------|
| ì‹¤ì‹œê°„ í˜¼ì¡ë„ | High | Medium | High |
| ì˜ˆì•½ ì‹œìŠ¤í…œ ì—°ë™ | Medium | High | Medium |
| ì‚¬ìš©ì ë¦¬ë·° | Medium | Medium | High |
| AI ì±„íŒ…ë´‡ | Low | High | Medium |
| ì˜¤í”„ë¼ì¸ ì§€ë„ | Low | Very High | Low |
| í‘¸ì‹œ ì•Œë¦¼ | Medium | Medium | Medium |

### 13.2 Technical Debt

- [ ] PostGIS í™•ì¥ìœ¼ë¡œ ì§€ë¦¬ ê²€ìƒ‰ ìµœì í™”
- [ ] Marker Clustering êµ¬í˜„ (ëŒ€ëŸ‰ ë§ˆì»¤ ì‹œ)
- [ ] Service Worker ì˜¤í”„ë¼ì¸ ì§€ì›
- [ ] E2E í…ŒìŠ¤íŠ¸ (Playwright)
- [ ] Storybook ì»´í¬ë„ŒíŠ¸ ë¬¸ì„œí™”
- [ ] Performance Budget ì„¤ì •

### 13.3 Scalability Roadmap

**í˜„ì¬ (MVP)**:
- ë‹¨ì¼ PostgreSQL ì¸ìŠ¤í„´ìŠ¤
- ì„œë²„ë¦¬ìŠ¤ API Routes
- í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°ë§

**Phase 2 (1,000 ë™ì‹œ ì‚¬ìš©ì)**:
- Read Replica ì¶”ê°€
- Redis ìºì‹± ë„ì…
- CDN ì—£ì§€ ìºì‹±

**Phase 3 (10,000 ë™ì‹œ ì‚¬ìš©ì)**:
- Elasticsearch ê²€ìƒ‰ ì—”ì§„
- ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë¶„ë¦¬ (ê²€ìƒ‰/ì¶”ì²œ)
- Kafka ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë°

---

## 14. ì°¸ê³  ìë£Œ

### 14.1 External APIs

| API | Documentation | Rate Limit |
|-----|---------------|------------|
| Kakao Maps | https://apis.map.kakao.com | 300k/day |
| Kakao Local | https://developers.kakao.com/docs/latest/ko/local/dev-guide | 300k/day |
| Claude API | https://docs.anthropic.com/claude/reference | 5k/day |
| í•œêµ­ê´€ê´‘ê³µì‚¬ | https://api.visitkorea.or.kr | Unlimited |

### 14.2 Internal Docs

- `/docs/planning/03-block-system.md`: Block Engine ì„¤ê³„
- `/docs/06-design-system.md`: UI/UX ê°€ì´ë“œë¼ì¸
- `/CLAUDE.md`: í”„ë¡œì íŠ¸ ì „ì²´ ì»¨í…ìŠ¤íŠ¸

### 14.3 Key Commits

```bash
# Type system & Prisma schema
git show 7a08d35

# Zustand stores
git show ed998c0

# API routes
git show 20d151b

# Kakao Map integration
git show 08c0242

# Bottom sheet
git show c1313b5

# Quick filter
git show fe8f941
```

---

## 15. ê²°ë¡ 

KidsMap ì•„í‚¤í…ì²˜ëŠ” **MAP-FIRST ì² í•™**ê³¼ **Kids-specific ë©”íƒ€ë°ì´í„°**ë¥¼ í•µì‹¬ìœ¼ë¡œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

### í•µì‹¬ ì„±ê³¼

âœ… **ì™„ì „í•œ íƒ€ì… ì•ˆì •ì„±**: TypeScript + Prismaë¡œ End-to-End íƒ€ì… ì²´í¬
âœ… **ìµœì í™”ëœ ìƒíƒœ ê´€ë¦¬**: 3ê°œ Zustand ìŠ¤í† ì–´ë¡œ ê´€ì‹¬ì‚¬ ë¶„ë¦¬
âœ… **AI ë„¤ì´í‹°ë¸Œ**: Claude APIë¡œ ë§¥ë½ ì¸ì‹ ì¶”ì²œ
âœ… **Kids ì „ìš©**: ìˆ˜ìœ ì‹¤, ê¸°ì €ê·€ êµí™˜ëŒ€, ë†€ì´ë°© í¬ê¸° ë“± í•µì‹¬ ë©”íƒ€
âœ… **í™•ì¥ ê°€ëŠ¥**: Block ì‹œìŠ¤í…œìœ¼ë¡œ ëŒ€ê·œëª¨ ë°ì´í„° ê´€ë¦¬

### ë‹¤ìŒ ë‹¨ê³„

1. âœ… í•µì‹¬ ì•„í‚¤í…ì²˜ ì™„ì„± (ë³¸ ë¬¸ì„œ)
2. ğŸ”„ CLAUDE.mdì— KidsMap í”„ë¡¬í”„íŠ¸ ì¶”ê°€
3. ğŸ“ API ë¬¸ì„œí™” (Swagger/OpenAPI)
4. ğŸ§ª E2E í…ŒìŠ¤íŠ¸ ì‘ì„±
5. ğŸš€ MVP ë°°í¬ (Vercel)

---

**ë¬¸ì„œ ë²„ì „**: 1.0
**ìµœì¢… ìˆ˜ì •**: 2026-02-01
**ì‘ì„±ì**: Claude (Sonnet 4.5)
**ì„¸ì…˜**: https://claude.ai/code/session_012jjXPRW8gGSpe4iwtGSCyL
